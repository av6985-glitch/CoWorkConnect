<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard | CoWorkConnect</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<script>
    const session = JSON.parse(localStorage.getItem("session"))
    if (!session || session.isAdmin) {
        window.location.href = "login.html"
    }
</script>

<header>
    <h2 style="color: white; margin-left: 20px;">Welcome, <span id="userName"></span>!</h2>
    <button onclick="app.auth.logout()">Logout</button>
</header>


<section>
    <h3>Available Workspaces</h3>
    <ul id="workspaceList"></ul>
</section>

<section>
    <h3>Your Bookings</h3>
    <ul id="bookingList"></ul>
</section>

<script type="module" src="js/app.js"></script>
<script>
function renderUserDashboard() {
    const session = JSON.parse(localStorage.getItem("session"))
    document.getElementById("userName").innerText = session.name

    const workspaces = app.admin.getAllWorkspaces()
    const wsList = document.getElementById("workspaceList")
    wsList.innerHTML = ""

    workspaces.forEach(ws => {
        const li = document.createElement("li")
        li.textContent = `${ws.name} - $${ws.price}`

        const btn = document.createElement("button")
        btn.textContent = "Book"
        btn.onclick = () => {
            app.booking.bookWorkspace(session, ws)
            renderBookings()
        }

        li.appendChild(btn)
        wsList.appendChild(li)
    })

    renderBookings()
}

function renderBookings() {
    const session = JSON.parse(localStorage.getItem("session"))
    const bookings = app.booking.getBookingsByUser(session.id)
    const list = document.getElementById("bookingList")

    list.innerHTML = ""
    if (!bookings.length) {
        list.innerHTML = "<li>No bookings yet.</li>"
        return
    }

    bookings.forEach(b => {
        const li = document.createElement("li")
        li.innerHTML = `
            ${b.workspaceName} - ${b.status}
            <button class="cancelBtn" onclick="cancelBooking(${b.id})">Cancel</button>
        `
        list.appendChild(li)
    })
}

function cancelBooking(id) {
    app.booking.cancelBooking(id)
    renderBookings()
}

document.addEventListener("DOMContentLoaded", renderUserDashboard)
</script>

</body>
</html>
